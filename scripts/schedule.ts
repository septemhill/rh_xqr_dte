import fetch from 'node-fetch'; // You might need to install node-fetch: npm install node-fetch @types/node-fetch

// Ensure your environment variable ALPHAVANTAGE_API_KEY is set
const ALPHAVANTAGE_API_KEY = process.env.ALPHAVANTAGE_API_KEY;

if (!ALPHAVANTAGE_API_KEY) {
    console.error('Error: ALPHAVANTAGE_API_KEY environment variable is not set.');
    process.exit(1);
}

const symbols: string[] = ['XDTE', 'QDTE', 'RDTE'];

const DailyPriceAPI_Base = 'https://www.alphavantage.co/query?function=TIME_SERIES_DAILY';
const DividendAPI_Base = 'https://www.alphavantage.co/query?function=DIVIDENDS';

interface DividendPrice {
    date: string;
    dividend: string;
    price: string;
}

interface DividendResponse {
    symbol: string;
    data: { ex_dividend_date: string, declaration_date: string, record_date: string, payment_date: string, amount: string }[]
}

interface PriceResponse {
    'Time Series (Daily)': {
        [date: string]: {
            '1. open': string, '2. high': string, '3. low': string, '4. close': string, '5. volume': string
        }
    };
}

async function priceAPI() {
    var json = {
        'Meta Data': {
            '1. Information': 'Daily Prices (open, high, low, close) and Volumes',
            '2. Symbol': 'RDTE',
            '3. Last Refreshed': '2025-06-12',
            '4. Output Size': 'Full size',
            '5. Time Zone': 'US/Eastern'
        },
        'Time Series (Daily)': {
            '2025-06-12': {
                '1. open': '34.1600',
                '2. high': '34.2560',
                '3. low': '34.0010',
                '4. close': '34.2500',
                '5. volume': '43304'
            },
            '2025-06-11': {
                '1. open': '34.7800',
                '2. high': '34.8300',
                '3. low': '34.4137',
                '4. close': '34.4500',
                '5. volume': '96985'
            },
            '2025-06-10': {
                '1. open': '34.5500',
                '2. high': '34.6700',
                '3. low': '34.4900',
                '4. close': '34.6100',
                '5. volume': '69322'
            },
            '2025-06-09': {
                '1. open': '34.4300',
                '2. high': '34.5000',
                '3. low': '34.1730',
                '4. close': '34.3700',
                '5. volume': '85589'
            },
            '2025-06-06': {
                '1. open': '33.9500',
                '2. high': '34.1150',
                '3. low': '33.9000',
                '4. close': '34.0900',
                '5. volume': '154435'
            },
            '2025-06-05': {
                '1. open': '33.5400',
                '2. high': '33.6900',
                '3. low': '33.2500',
                '4. close': '33.5500',
                '5. volume': '49844'
            },
            '2025-06-04': {
                '1. open': '33.9400',
                '2. high': '33.9899',
                '3. low': '33.7300',
                '4. close': '33.8000',
                '5. volume': '106054'
            },
            '2025-06-03': {
                '1. open': '33.5000',
                '2. high': '33.8199',
                '3. low': '33.4201',
                '4. close': '33.7400',
                '5. volume': '51979'
            },
            '2025-06-02': {
                '1. open': '33.4200',
                '2. high': '33.4542',
                '3. low': '32.9537',
                '4. close': '33.4500',
                '5. volume': '117741'
            },
            '2025-05-30': {
                '1. open': '33.3700',
                '2. high': '33.4100',
                '3. low': '33.0453',
                '4. close': '33.2600',
                '5. volume': '105329'
            },
            '2025-05-29': {
                '1. open': '33.6300',
                '2. high': '33.6300',
                '3. low': '33.2000',
                '4. close': '33.4400',
                '5. volume': '58793'
            },
            '2025-05-28': {
                '1. open': '33.8200',
                '2. high': '33.9999',
                '3. low': '33.5000',
                '4. close': '33.6200',
                '5. volume': '93909'
            },
            '2025-05-27': {
                '1. open': '33.5500',
                '2. high': '33.8500',
                '3. low': '33.4000',
                '4. close': '33.8200',
                '5. volume': '74638'
            },
            '2025-05-23': {
                '1. open': '32.8400',
                '2. high': '33.1450',
                '3. low': '32.6100',
                '4. close': '33.1300',
                '5. volume': '87967'
            },
            '2025-05-22': {
                '1. open': '32.9500',
                '2. high': '33.2999',
                '3. low': '32.8619',
                '4. close': '33.1900',
                '5. volume': '57801'
            },
            '2025-05-21': {
                '1. open': '34.0700',
                '2. high': '34.1400',
                '3. low': '33.3412',
                '4. close': '33.4200',
                '5. volume': '105254'
            },
            '2025-05-20': {
                '1. open': '34.1300',
                '2. high': '34.3395',
                '3. low': '34.0201',
                '4. close': '34.2000',
                '5. volume': '45555'
            },
            '2025-05-19': {
                '1. open': '33.8700',
                '2. high': '34.1800',
                '3. low': '33.8250',
                '4. close': '34.1800',
                '5. volume': '68957'
            },
            '2025-05-16': {
                '1. open': '34.1300',
                '2. high': '34.3495',
                '3. low': '34.0000',
                '4. close': '34.3200',
                '5. volume': '78765'
            },
            '2025-05-15': {
                '1. open': '33.9000',
                '2. high': '34.0600',
                '3. low': '33.6000',
                '4. close': '34.0600',
                '5. volume': '39129'
            },
            '2025-05-14': {
                '1. open': '34.2500',
                '2. high': '34.3200',
                '3. low': '34.0000',
                '4. close': '34.0900',
                '5. volume': '129568'
            },
            '2025-05-13': {
                '1. open': '34.3800',
                '2. high': '34.4680',
                '3. low': '34.1200',
                '4. close': '34.2900',
                '5. volume': '52030'
            },
            '2025-05-12': {
                '1. open': '34.3000',
                '2. high': '34.3349',
                '3. low': '33.7615',
                '4. close': '33.9800',
                '5. volume': '75640'
            },
            '2025-05-09': {
                '1. open': '32.9600',
                '2. high': '33.0200',
                '3. low': '32.6866',
                '4. close': '33.0200',
                '5. volume': '36106'
            },
            '2025-05-08': {
                '1. open': '32.6400',
                '2. high': '32.9799',
                '3. low': '32.3300',
                '4. close': '32.8700',
                '5. volume': '51271'
            },
            '2025-05-07': {
                '1. open': '32.4800',
                '2. high': '32.6899',
                '3. low': '32.2100',
                '4. close': '32.4400',
                '5. volume': '48632'
            },
            '2025-05-06': {
                '1. open': '32.1900',
                '2. high': '32.5700',
                '3. low': '32.1600',
                '4. close': '32.2876',
                '5. volume': '50941'
            },
            '2025-05-05': {
                '1. open': '32.4500',
                '2. high': '32.7899',
                '3. low': '32.4300',
                '4. close': '32.6100',
                '5. volume': '43660'
            },
            '2025-05-02': {
                '1. open': '32.2700',
                '2. high': '32.7899',
                '3. low': '32.2501',
                '4. close': '32.7500',
                '5. volume': '80151'
            },
            '2025-05-01': {
                '1. open': '31.8700',
                '2. high': '32.2270',
                '3. low': '31.6900',
                '4. close': '31.9444',
                '5. volume': '44296'
            },
            '2025-04-30': {
                '1. open': '31.7000',
                '2. high': '32.1400',
                '3. low': '31.4200',
                '4. close': '32.1300',
                '5. volume': '71493'
            },
            '2025-04-29': {
                '1. open': '31.9700',
                '2. high': '32.2800',
                '3. low': '31.7950',
                '4. close': '32.2400',
                '5. volume': '54950'
            },
            '2025-04-28': {
                '1. open': '31.8800',
                '2. high': '32.1338',
                '3. low': '31.6061',
                '4. close': '32.0100',
                '5. volume': '81004'
            },
            '2025-04-25': {
                '1. open': '31.5900',
                '2. high': '31.7900',
                '3. low': '31.3959',
                '4. close': '31.7900',
                '5. volume': '73956'
            },
            '2025-04-24': {
                '1. open': '31.3500',
                '2. high': '31.8899',
                '3. low': '31.3500',
                '4. close': '31.7000',
                '5. volume': '29211'
            },
            '2025-04-23': {
                '1. open': '31.9800',
                '2. high': '32.4200',
                '3. low': '31.6251',
                '4. close': '31.7200',
                '5. volume': '162951'
            },
            '2025-04-22': {
                '1. open': '30.6200',
                '2. high': '31.1000',
                '3. low': '30.6060',
                '4. close': '31.0000',
                '5. volume': '101860'
            },
            '2025-04-21': {
                '1. open': '30.5800',
                '2. high': '30.7829',
                '3. low': '29.9602',
                '4. close': '30.2600',
                '5. volume': '60319'
            },
            '2025-04-17': {
                '1. open': '30.6400',
                '2. high': '31.0237',
                '3. low': '30.5700',
                '4. close': '30.8300',
                '5. volume': '66957'
            },
            '2025-04-16': {
                '1. open': '30.5700',
                '2. high': '30.8090',
                '3. low': '30.1500',
                '4. close': '30.5700',
                '5. volume': '60986'
            },
            '2025-04-15': {
                '1. open': '30.9000',
                '2. high': '31.2300',
                '3. low': '30.9000',
                '4. close': '31.0400',
                '5. volume': '36544'
            },
            '2025-04-14': {
                '1. open': '31.0500',
                '2. high': '31.1900',
                '3. low': '30.4133',
                '4. close': '30.9500',
                '5. volume': '45428'
            },
            '2025-04-11': {
                '1. open': '30.1000',
                '2. high': '30.7000',
                '3. low': '29.6100',
                '4. close': '30.6000',
                '5. volume': '60775'
            },
            '2025-04-10': {
                '1. open': '30.8300',
                '2. high': '30.8500',
                '3. low': '29.3896',
                '4. close': '30.1500',
                '5. volume': '104451'
            },
            '2025-04-09': {
                '1. open': '30.0700',
                '2. high': '32.3900',
                '3. low': '30.0700',
                '4. close': '31.4600',
                '5. volume': '122459'
            },
            '2025-04-08': {
                '1. open': '32.4100',
                '2. high': '32.4143',
                '3. low': '30.0900',
                '4. close': '30.4600',
                '5. volume': '79702'
            },
            '2025-04-07': {
                '1. open': '30.2300',
                '2. high': '32.6890',
                '3. low': '29.8900',
                '4. close': '31.2500',
                '5. volume': '276636'
            },
            '2025-04-04': {
                '1. open': '31.5900',
                '2. high': '31.8500',
                '3. low': '30.7050',
                '4. close': '31.3100',
                '5. volume': '213858'
            },
            '2025-04-03': {
                '1. open': '33.5200',
                '2. high': '33.8671',
                '3. low': '32.7800',
                '4. close': '32.8300',
                '5. volume': '99705'
            },
            '2025-04-02': {
                '1. open': '34.9900',
                '2. high': '35.6893',
                '3. low': '34.9000',
                '4. close': '35.6200',
                '5. volume': '133191'
            },
            '2025-04-01': {
                '1. open': '35.2300',
                '2. high': '35.5800',
                '3. low': '34.9700',
                '4. close': '35.4000',
                '5. volume': '65617'
            },
            '2025-03-31': {
                '1. open': '34.9800',
                '2. high': '35.4000',
                '3. low': '34.7200',
                '4. close': '35.3600',
                '5. volume': '101883'
            },
            '2025-03-28': {
                '1. open': '36.1800',
                '2. high': '36.2000',
                '3. low': '35.3900',
                '4. close': '35.4500',
                '5. volume': '64048'
            },
            '2025-03-27': {
                '1. open': '36.2400',
                '2. high': '36.4400',
                '3. low': '36.0642',
                '4. close': '36.2100',
                '5. volume': '33443'
            },
            '2025-03-26': {
                '1. open': '36.9600',
                '2. high': '37.0900',
                '3. low': '36.3437',
                '4. close': '36.5400',
                '5. volume': '117227'
            },
            '2025-03-25': {
                '1. open': '37.0500',
                '2. high': '37.0699',
                '3. low': '36.8500',
                '4. close': '36.9000',
                '5. volume': '43665'
            },
            '2025-03-24': {
                '1. open': '36.7000',
                '2. high': '37.0800',
                '3. low': '36.7000',
                '4. close': '37.0000',
                '5. volume': '65709'
            },
            '2025-03-21': {
                '1. open': '35.9900',
                '2. high': '36.2100',
                '3. low': '35.7600',
                '4. close': '36.1400',
                '5. volume': '61211'
            },
            '2025-03-20': {
                '1. open': '36.2000',
                '2. high': '36.5700',
                '3. low': '36.1801',
                '4. close': '36.3400',
                '5. volume': '28760'
            },
            '2025-03-19': {
                '1. open': '36.3400',
                '2. high': '36.8941',
                '3. low': '36.3400',
                '4. close': '36.7700',
                '5. volume': '31027'
            },
            '2025-03-18': {
                '1. open': '36.5000',
                '2. high': '36.5000',
                '3. low': '36.1900',
                '4. close': '36.2700',
                '5. volume': '60114'
            },
            '2025-03-17': {
                '1. open': '36.2200',
                '2. high': '36.6787',
                '3. low': '36.1500',
                '4. close': '36.6500',
                '5. volume': '73657'
            },
            '2025-03-14': {
                '1. open': '35.7200',
                '2. high': '36.2500',
                '3. low': '35.7000',
                '4. close': '36.2000',
                '5. volume': '43430'
            },
            '2025-03-13': {
                '1. open': '35.8500',
                '2. high': '35.9863',
                '3. low': '35.1805',
                '4. close': '35.3400',
                '5. volume': '49634'
            },
            '2025-03-12': {
                '1. open': '36.5600',
                '2. high': '36.6094',
                '3. low': '36.0000',
                '4. close': '36.1500',
                '5. volume': '69945'
            },
            '2025-03-11': {
                '1. open': '36.0300',
                '2. high': '36.5288',
                '3. low': '35.6801',
                '4. close': '36.0600',
                '5. volume': '77281'
            },
            '2025-03-10': {
                '1. open': '36.4300',
                '2. high': '36.7180',
                '3. low': '35.6200',
                '4. close': '35.9200',
                '5. volume': '183241'
            },
            '2025-03-07': {
                '1. open': '36.6800',
                '2. high': '37.1093',
                '3. low': '36.1600',
                '4. close': '36.8400',
                '5. volume': '109808'
            },
            '2025-03-06': {
                '1. open': '36.9100',
                '2. high': '37.2047',
                '3. low': '36.5500',
                '4. close': '36.7500',
                '5. volume': '59499'
            },
            '2025-03-05': {
                '1. open': '37.1400',
                '2. high': '37.5004',
                '3. low': '36.8000',
                '4. close': '37.4800',
                '5. volume': '77380'
            },
            '2025-03-04': {
                '1. open': '36.8600',
                '2. high': '37.3200',
                '3. low': '36.4700',
                '4. close': '37.0600',
                '5. volume': '142714'
            },
            '2025-03-03': {
                '1. open': '38.5100',
                '2. high': '38.5650',
                '3. low': '37.1500',
                '4. close': '37.3200',
                '5. volume': '140422'
            },
            '2025-02-28': {
                '1. open': '37.8600',
                '2. high': '38.3650',
                '3. low': '37.7939',
                '4. close': '38.3650',
                '5. volume': '224831'
            },
            '2025-02-27': {
                '1. open': '38.5000',
                '2. high': '38.6798',
                '3. low': '37.9200',
                '4. close': '37.9300',
                '5. volume': '101766'
            },
            '2025-02-26': {
                '1. open': '38.7500',
                '2. high': '39.1000',
                '3. low': '38.5700',
                '4. close': '38.7500',
                '5. volume': '74432'
            },
            '2025-02-25': {
                '1. open': '38.7000',
                '2. high': '38.8851',
                '3. low': '38.3000',
                '4. close': '38.6200',
                '5. volume': '155514'
            },
            '2025-02-24': {
                '1. open': '39.0500',
                '2. high': '39.2141',
                '3. low': '38.5400',
                '4. close': '38.6900',
                '5. volume': '152812'
            },
            '2025-02-21': {
                '1. open': '40.4700',
                '2. high': '40.4700',
                '3. low': '38.8901',
                '4. close': '38.9400',
                '5. volume': '166899'
            },
            '2025-02-20': {
                '1. open': '40.4800',
                '2. high': '40.4800',
                '3. low': '39.9016',
                '4. close': '40.1700',
                '5. volume': '92897'
            },
            '2025-02-19': {
                '1. open': '40.5200',
                '2. high': '40.7400',
                '3. low': '40.4361',
                '4. close': '40.7200',
                '5. volume': '93175'
            },
            '2025-02-18': {
                '1. open': '40.5900',
                '2. high': '40.8096',
                '3. low': '40.5100',
                '4. close': '40.7600',
                '5. volume': '127635'
            },
            '2025-02-14': {
                '1. open': '40.6600',
                '2. high': '40.8200',
                '3. low': '40.4801',
                '4. close': '40.5000',
                '5. volume': '80864'
            },
            '2025-02-13': {
                '1. open': '40.2600',
                '2. high': '40.5500',
                '3. low': '40.1120',
                '4. close': '40.5100',
                '5. volume': '99442'
            },
            '2025-02-12': {
                '1. open': '40.0600',
                '2. high': '40.4100',
                '3. low': '39.9500',
                '4. close': '40.3300',
                '5. volume': '155378'
            },
            '2025-02-11': {
                '1. open': '40.5200',
                '2. high': '40.6899',
                '3. low': '40.4300',
                '4. close': '40.6700',
                '5. volume': '98033'
            },
            '2025-02-10': {
                '1. open': '40.8900',
                '2. high': '40.9418',
                '3. low': '40.6100',
                '4. close': '40.8500',
                '5. volume': '94630'
            },
            '2025-02-07': {
                '1. open': '41.0050',
                '2. high': '41.1750',
                '3. low': '40.5300',
                '4. close': '40.6100',
                '5. volume': '145292'
            },
            '2025-02-06': {
                '1. open': '41.2900',
                '2. high': '41.3799',
                '3. low': '40.7800',
                '4. close': '41.0600',
                '5. volume': '94774'
            },
            '2025-02-05': {
                '1. open': '41.1500',
                '2. high': '41.4727',
                '3. low': '41.0101',
                '4. close': '41.4600',
                '5. volume': '177215'
            },
            '2025-02-04': {
                '1. open': '40.5900',
                '2. high': '41.0435',
                '3. low': '40.5000',
                '4. close': '41.0100',
                '5. volume': '151926'
            },
            '2025-02-03': {
                '1. open': '40.0000',
                '2. high': '40.6700',
                '3. low': '39.9700',
                '4. close': '40.5300',
                '5. volume': '204630'
            },
            '2025-01-31': {
                '1. open': '41.4000',
                '2. high': '41.5800',
                '3. low': '40.8100',
                '4. close': '41.0100',
                '5. volume': '126628'
            },
            '2025-01-30': {
                '1. open': '41.1500',
                '2. high': '41.5099',
                '3. low': '41.0550',
                '4. close': '41.3200',
                '5. volume': '88775'
            },
            '2025-01-29': {
                '1. open': '41.1000',
                '2. high': '41.2192',
                '3. low': '40.7219',
                '4. close': '41.0700',
                '5. volume': '111807'
            },
            '2025-01-28': {
                '1. open': '41.1100',
                '2. high': '41.1900',
                '3. low': '40.7501',
                '4. close': '41.0900',
                '5. volume': '88418'
            },
            '2025-01-27': {
                '1. open': '41.0900',
                '2. high': '41.4400',
                '3. low': '40.7414',
                '4. close': '41.0300',
                '5. volume': '170640'
            },
            '2025-01-24': {
                '1. open': '41.3500',
                '2. high': '41.5999',
                '3. low': '41.1900',
                '4. close': '41.3700',
                '5. volume': '198365'
            },
            '2025-01-23': {
                '1. open': '41.3200',
                '2. high': '41.4900',
                '3. low': '41.1600',
                '4. close': '41.4900',
                '5. volume': '65072'
            },
            '2025-01-22': {
                '1. open': '41.8100',
                '2. high': '41.8400',
                '3. low': '41.5054',
                '4. close': '41.6400',
                '5. volume': '185999'
            },
            '2025-01-21': {
                '1. open': '41.5800',
                '2. high': '41.9100',
                '3. low': '41.4596',
                '4. close': '41.8600',
                '5. volume': '198036'
            },
            '2025-01-17': {
                '1. open': '41.4500',
                '2. high': '41.4500',
                '3. low': '41.0700',
                '4. close': '41.1700',
                '5. volume': '91608'
            },
            '2025-01-16': {
                '1. open': '40.9300',
                '2. high': '41.0000',
                '3. low': '40.6700',
                '4. close': '40.9600',
                '5. volume': '72828'
            },
            '2025-01-15': {
                '1. open': '41.3900',
                '2. high': '41.4640',
                '3. low': '41.0660',
                '4. close': '41.2900',
                '5. volume': '99481'
            },
            '2025-01-14': {
                '1. open': '40.3200',
                '2. high': '40.4620',
                '3. low': '39.9646',
                '4. close': '40.3700',
                '5. volume': '70477'
            },
            '2025-01-13': {
                '1. open': '39.4400',
                '2. high': '39.9600',
                '3. low': '39.4000',
                '4. close': '39.9400',
                '5. volume': '148615'
            },
            '2025-01-10': {
                '1. open': '40.0800',
                '2. high': '40.3946',
                '3. low': '39.6401',
                '4. close': '39.8500',
                '5. volume': '157884'
            },
            '2025-01-08': {
                '1. open': '40.7300',
                '2. high': '40.8000',
                '3. low': '40.2900',
                '4. close': '40.7900',
                '5. volume': '111507'
            },
            '2025-01-07': {
                '1. open': '41.6300',
                '2. high': '41.7350',
                '3. low': '40.8521',
                '4. close': '41.0900',
                '5. volume': '159015'
            },
            '2025-01-06': {
                '1. open': '41.6700',
                '2. high': '41.8588',
                '3. low': '41.3500',
                '4. close': '41.4500',
                '5. volume': '146770'
            },
            '2025-01-03': {
                '1. open': '40.9400',
                '2. high': '41.4200',
                '3. low': '40.8900',
                '4. close': '41.4100',
                '5. volume': '159287'
            },
            '2025-01-02': {
                '1. open': '41.1600',
                '2. high': '41.2500',
                '3. low': '40.5355',
                '4. close': '40.8400',
                '5. volume': '165310'
            },
            '2024-12-31': {
                '1. open': '41.4500',
                '2. high': '41.5500',
                '3. low': '41.1500',
                '4. close': '41.3300',
                '5. volume': '147202'
            },
            '2024-12-30': {
                '1. open': '41.0800',
                '2. high': '41.2600',
                '3. low': '40.5800',
                '4. close': '41.2200',
                '5. volume': '166687'
            },
            '2024-12-27': {
                '1. open': '41.6600',
                '2. high': '41.7800',
                '3. low': '40.9600',
                '4. close': '41.3500',
                '5. volume': '155332'
            },
            '2024-12-26': {
                '1. open': '41.6300',
                '2. high': '41.9454',
                '3. low': '41.4149',
                '4. close': '41.9300',
                '5. volume': '75379'
            },
            '2024-12-24': {
                '1. open': '41.7000',
                '2. high': '42.0400',
                '3. low': '41.4283',
                '4. close': '42.0400',
                '5. volume': '115531'
            },
            '2024-12-23': {
                '1. open': '41.7600',
                '2. high': '41.8000',
                '3. low': '41.2800',
                '4. close': '41.6800',
                '5. volume': '225682'
            },
            '2024-12-20': {
                '1. open': '41.0100',
                '2. high': '41.7700',
                '3. low': '41.0000',
                '4. close': '41.6500',
                '5. volume': '175782'
            },
            '2024-12-19': {
                '1. open': '41.8700',
                '2. high': '42.0441',
                '3. low': '41.0431',
                '4. close': '41.2000',
                '5. volume': '193795'
            },
            '2024-12-18': {
                '1. open': '43.5100',
                '2. high': '43.6845',
                '3. low': '41.3200',
                '4. close': '41.6000',
                '5. volume': '440331'
            },
            '2024-12-17': {
                '1. open': '43.7000',
                '2. high': '43.7600',
                '3. low': '43.3600',
                '4. close': '43.4200',
                '5. volume': '214769'
            },
            '2024-12-16': {
                '1. open': '43.8000',
                '2. high': '43.8000',
                '3. low': '43.6300',
                '4. close': '43.7700',
                '5. volume': '325545'
            },
            '2024-12-13': {
                '1. open': '43.8600',
                '2. high': '43.8800',
                '3. low': '43.4000',
                '4. close': '43.6300',
                '5. volume': '313107'
            },
            '2024-12-12': {
                '1. open': '44.3000',
                '2. high': '44.3300',
                '3. low': '43.7900',
                '4. close': '43.8400',
                '5. volume': '235036'
            },
            '2024-12-11': {
                '1. open': '44.8900',
                '2. high': '45.0100',
                '3. low': '44.5457',
                '4. close': '44.7800',
                '5. volume': '307201'
            },
            '2024-12-10': {
                '1. open': '44.7100',
                '2. high': '44.8000',
                '3. low': '44.3701',
                '4. close': '44.5000',
                '5. volume': '158674'
            },
            '2024-12-09': {
                '1. open': '45.1000',
                '2. high': '45.2472',
                '3. low': '44.6400',
                '4. close': '44.6600',
                '5. volume': '232639'
            },
            '2024-12-06': {
                '1. open': '44.8900',
                '2. high': '44.9300',
                '3. low': '44.6900',
                '4. close': '44.8200',
                '5. volume': '188679'
            },
            '2024-12-05': {
                '1. open': '45.0300',
                '2. high': '45.0800',
                '3. low': '44.5800',
                '4. close': '44.5800',
                '5. volume': '204364'
            },
            '2024-12-04': {
                '1. open': '45.2300',
                '2. high': '45.4800',
                '3. low': '45.0900',
                '4. close': '45.4300',
                '5. volume': '269838'
            },
            '2024-12-03': {
                '1. open': '45.7000',
                '2. high': '45.7000',
                '3. low': '45.0511',
                '4. close': '45.1700',
                '5. volume': '201675'
            },
            '2024-12-02': {
                '1. open': '45.5750',
                '2. high': '45.6300',
                '3. low': '45.1199',
                '4. close': '45.4900',
                '5. volume': '280902'
            },
            '2024-11-29': {
                '1. open': '45.5700',
                '2. high': '45.7580',
                '3. low': '45.3470',
                '4. close': '45.4500',
                '5. volume': '107855'
            },
            '2024-11-27': {
                '1. open': '45.8000',
                '2. high': '45.8000',
                '3. low': '45.1500',
                '4. close': '45.2800',
                '5. volume': '159497'
            },
            '2024-11-26': {
                '1. open': '45.4200',
                '2. high': '45.5500',
                '3. low': '45.1125',
                '4. close': '45.4000',
                '5. volume': '248773'
            },
            '2024-11-25': {
                '1. open': '45.3300',
                '2. high': '45.7500',
                '3. low': '45.2200',
                '4. close': '45.6700',
                '5. volume': '260002'
            },
            '2024-11-22': {
                '1. open': '44.5400',
                '2. high': '44.9200',
                '3. low': '44.4600',
                '4. close': '44.9000',
                '5. volume': '152934'
            },
            '2024-11-21': {
                '1. open': '43.9100',
                '2. high': '44.2800',
                '3. low': '43.7101',
                '4. close': '44.2300',
                '5. volume': '128647'
            },
            '2024-11-20': {
                '1. open': '44.3500',
                '2. high': '44.3500',
                '3. low': '43.5300',
                '4. close': '44.0300',
                '5. volume': '253448'
            },
            '2024-11-19': {
                '1. open': '44.1000',
                '2. high': '44.1250',
                '3. low': '43.5200',
                '4. close': '44.0000',
                '5. volume': '142649'
            },
            '2024-11-18': {
                '1. open': '44.2000',
                '2. high': '44.3150',
                '3. low': '43.9100',
                '4. close': '44.1400',
                '5. volume': '157299'
            },
            '2024-11-15': {
                '1. open': '44.6500',
                '2. high': '44.6500',
                '3. low': '43.8400',
                '4. close': '44.0400',
                '5. volume': '108999'
            },
            '2024-11-14': {
                '1. open': '45.3600',
                '2. high': '45.4000',
                '3. low': '44.4900',
                '4. close': '44.6100',
                '5. volume': '89293'
            },
            '2024-11-13': {
                '1. open': '46.1700',
                '2. high': '46.3089',
                '3. low': '45.4000',
                '4. close': '45.4900',
                '5. volume': '199745'
            },
            '2024-11-12': {
                '1. open': '46.2100',
                '2. high': '46.4750',
                '3. low': '45.7500',
                '4. close': '45.8700',
                '5. volume': '151377'
            },
            '2024-11-11': {
                '1. open': '46.2700',
                '2. high': '46.5600',
                '3. low': '46.0884',
                '4. close': '46.5100',
                '5. volume': '169485'
            },
            '2024-11-08': {
                '1. open': '45.2500',
                '2. high': '45.7740',
                '3. low': '45.2500',
                '4. close': '45.6500',
                '5. volume': '133215'
            },
            '2024-11-07': {
                '1. open': '45.4300',
                '2. high': '45.6400',
                '3. low': '45.2100',
                '4. close': '45.4000',
                '5. volume': '84842'
            },
            '2024-11-06': {
                '1. open': '44.6800',
                '2. high': '45.7400',
                '3. low': '43.6500',
                '4. close': '45.6200',
                '5. volume': '193629'
            },
            '2024-11-05': {
                '1. open': '42.8600',
                '2. high': '43.4200',
                '3. low': '42.8600',
                '4. close': '43.1000',
                '5. volume': '120237'
            },
            '2024-11-04': {
                '1. open': '42.7200',
                '2. high': '43.0300',
                '3. low': '42.5365',
                '4. close': '42.9400',
                '5. volume': '129774'
            },
            '2024-11-01': {
                '1. open': '42.7700',
                '2. high': '42.9800',
                '3. low': '42.5700',
                '4. close': '42.7800',
                '5. volume': '69966'
            },
            '2024-10-31': {
                '1. open': '43.0400',
                '2. high': '43.0700',
                '3. low': '42.4400',
                '4. close': '42.4900',
                '5. volume': '98534'
            },
            '2024-10-30': {
                '1. open': '43.2700',
                '2. high': '43.5500',
                '3. low': '43.2001',
                '4. close': '43.3700',
                '5. volume': '165696'
            },
            '2024-10-29': {
                '1. open': '43.1100',
                '2. high': '43.3600',
                '3. low': '42.8700',
                '4. close': '43.3200',
                '5. volume': '113233'
            },
            '2024-10-28': {
                '1. open': '43.1300',
                '2. high': '43.4500',
                '3. low': '43.0734',
                '4. close': '43.4400',
                '5. volume': '98242'
            },
            '2024-10-25': {
                '1. open': '43.1500',
                '2. high': '43.2900',
                '3. low': '42.7002',
                '4. close': '42.7800',
                '5. volume': '81707'
            },
            '2024-10-24': {
                '1. open': '43.0100',
                '2. high': '43.0600',
                '3. low': '42.6800',
                '4. close': '42.9200',
                '5. volume': '63346'
            },
            '2024-10-23': {
                '1. open': '43.2200',
                '2. high': '43.2900',
                '3. low': '42.7500',
                '4. close': '43.1200',
                '5. volume': '183112'
            },
            '2024-10-22': {
                '1. open': '43.4000',
                '2. high': '43.4800',
                '3. low': '43.2000',
                '4. close': '43.4187',
                '5. volume': '84257'
            },
            '2024-10-21': {
                '1. open': '44.2100',
                '2. high': '44.2100',
                '3. low': '43.4001',
                '4. close': '43.5100',
                '5. volume': '184546'
            },
            '2024-10-18': {
                '1. open': '44.3400',
                '2. high': '44.3500',
                '3. low': '44.1200',
                '4. close': '44.2200',
                '5. volume': '84246'
            },
            '2024-10-17': {
                '1. open': '44.3700',
                '2. high': '44.3700',
                '3. low': '44.0200',
                '4. close': '44.2300',
                '5. volume': '67859'
            },
            '2024-10-16': {
                '1. open': '44.2700',
                '2. high': '44.6200',
                '3. low': '44.2001',
                '4. close': '44.5700',
                '5. volume': '99097'
            },
            '2024-10-15': {
                '1. open': '43.8900',
                '2. high': '44.1700',
                '3. low': '43.7797',
                '4. close': '43.9200',
                '5. volume': '79636'
            },
            '2024-10-14': {
                '1. open': '43.7800',
                '2. high': '43.9400',
                '3. low': '43.5100',
                '4. close': '43.8700',
                '5. volume': '111365'
            },
            '2024-10-11': {
                '1. open': '43.4800',
                '2. high': '43.8000',
                '3. low': '43.4800',
                '4. close': '43.7900',
                '5. volume': '82189'
            },
            '2024-10-10': {
                '1. open': '43.3500',
                '2. high': '43.5300',
                '3. low': '43.0300',
                '4. close': '43.5300',
                '5. volume': '86463'
            },
            '2024-10-09': {
                '1. open': '44.0100',
                '2. high': '44.0100',
                '3. low': '43.7401',
                '4. close': '43.9800',
                '5. volume': '111222'
            },
            '2024-10-08': {
                '1. open': '43.8100',
                '2. high': '44.0500',
                '3. low': '43.6700',
                '4. close': '43.9300',
                '5. volume': '88987'
            },
            '2024-10-07': {
                '1. open': '44.0000',
                '2. high': '44.0100',
                '3. low': '43.5200',
                '4. close': '43.7900',
                '5. volume': '152687'
            },
            '2024-10-04': {
                '1. open': '44.0400',
                '2. high': '44.1400',
                '3. low': '43.7500',
                '4. close': '44.1400',
                '5. volume': '101785'
            },
            '2024-10-03': {
                '1. open': '43.4800',
                '2. high': '43.6100',
                '3. low': '43.1900',
                '4. close': '43.5100',
                '5. volume': '71431'
            },
            '2024-10-02': {
                '1. open': '43.9900',
                '2. high': '44.1991',
                '3. low': '43.8275',
                '4. close': '44.1250',
                '5. volume': '239502'
            },
            '2024-10-01': {
                '1. open': '44.6000',
                '2. high': '44.6000',
                '3. low': '43.8198',
                '4. close': '44.1200',
                '5. volume': '107027'
            },
            '2024-09-30': {
                '1. open': '44.4700',
                '2. high': '44.8200',
                '3. low': '44.3300',
                '4. close': '44.7200',
                '5. volume': '105256'
            },
            '2024-09-27': {
                '1. open': '44.6400',
                '2. high': '44.8542',
                '3. low': '44.3800',
                '4. close': '44.6466',
                '5. volume': '85851'
            },
            '2024-09-26': {
                '1. open': '44.2800',
                '2. high': '44.5000',
                '3. low': '44.0942',
                '4. close': '44.3100',
                '5. volume': '107608'
            },
            '2024-09-25': {
                '1. open': '44.8700',
                '2. high': '44.8880',
                '3. low': '44.3000',
                '4. close': '44.3100',
                '5. volume': '207650'
            },
            '2024-09-24': {
                '1. open': '44.9400',
                '2. high': '44.9500',
                '3. low': '44.5400',
                '4. close': '44.8600',
                '5. volume': '64577'
            },
            '2024-09-23': {
                '1. open': '45.0300',
                '2. high': '45.0882',
                '3. low': '44.5471',
                '4. close': '44.7300',
                '5. volume': '81729'
            },
            '2024-09-20': {
                '1. open': '45.1100',
                '2. high': '45.1300',
                '3. low': '44.8000',
                '4. close': '44.8800',
                '5. volume': '52623'
            },
            '2024-09-19': {
                '1. open': '45.4300',
                '2. high': '45.4300',
                '3. low': '44.8100',
                '4. close': '45.2025',
                '5. volume': '56062'
            },
            '2024-09-18': {
                '1. open': '44.2000',
                '2. high': '45.0500',
                '3. low': '44.0500',
                '4. close': '44.3262',
                '5. volume': '75915'
            },
            '2024-09-17': {
                '1. open': '44.2300',
                '2. high': '44.5200',
                '3. low': '44.0445',
                '4. close': '44.2500',
                '5. volume': '60832'
            },
            '2024-09-16': {
                '1. open': '43.7600',
                '2. high': '43.8500',
                '3. low': '43.5001',
                '4. close': '43.8300',
                '5. volume': '81143'
            },
            '2024-09-13': {
                '1. open': '43.1600',
                '2. high': '43.5300',
                '3. low': '43.1600',
                '4. close': '43.5300',
                '5. volume': '63043'
            },
            '2024-09-12': {
                '1. open': '42.2800',
                '2. high': '42.7099',
                '3. low': '42.1179',
                '4. close': '42.5956',
                '5. volume': '56223'
            },
            '2024-09-11': {
                '1. open': '41.8900',
                '2. high': '42.1850',
                '3. low': '41.2905',
                '4. close': '42.1800',
                '5. volume': '93248'
            },
            '2024-09-10': {
                '1. open': '42.1900',
                '2. high': '42.1900',
                '3. low': '41.5795',
                '4. close': '42.0011',
                '5. volume': '118809'
            }
        }
    }
    return json
}

async function dividendAPI() {
    var json = {
        symbol: 'RDTE',
        data: [
            {
                ex_dividend_date: '2025-06-12',
                declaration_date: '2025-01-08',
                record_date: '2025-06-12',
                payment_date: '2025-06-13',
                amount: '0.134876'
            },
            {
                ex_dividend_date: '2025-06-05',
                declaration_date: '2025-01-08',
                record_date: '2025-06-05',
                payment_date: '2025-06-06',
                amount: '0.300745'
            },
            {
                ex_dividend_date: '2025-05-29',
                declaration_date: '2025-01-08',
                record_date: '2025-05-29',
                payment_date: '2025-05-30',
                amount: '0.267197'
            },
            {
                ex_dividend_date: '2025-05-22',
                declaration_date: '2025-01-08',
                record_date: '2025-05-22',
                payment_date: '2025-05-23',
                amount: '0.24942'
            },
            {
                ex_dividend_date: '2025-05-15',
                declaration_date: 'None',
                record_date: 'None',
                payment_date: 'None',
                amount: '0.236833'
            },
            {
                ex_dividend_date: '2025-05-08',
                declaration_date: '2025-01-08',
                record_date: '2025-05-08',
                payment_date: '2025-05-09',
                amount: '0.238059'
            },
            {
                ex_dividend_date: '2025-05-01',
                declaration_date: '2025-01-08',
                record_date: '2025-05-01',
                payment_date: '2025-05-02',
                amount: '0.252788'
            },
            {
                ex_dividend_date: '2025-04-24',
                declaration_date: '2025-01-08',
                record_date: '2025-04-24',
                payment_date: '2025-04-25',
                amount: '0.311538'
            },
            {
                ex_dividend_date: '2025-04-16',
                declaration_date: '2025-01-08',
                record_date: '2025-04-16',
                payment_date: '2025-04-17',
                amount: '0.235906'
            },
            {
                ex_dividend_date: '2025-04-10',
                declaration_date: '2025-01-08',
                record_date: '2025-04-10',
                payment_date: '2025-04-11',
                amount: '0.24647'
            },
            {
                ex_dividend_date: '2025-04-03',
                declaration_date: '2025-01-08',
                record_date: '2025-04-03',
                payment_date: '2025-04-04',
                amount: '0.322066'
            },
            {
                ex_dividend_date: '2025-03-27',
                declaration_date: '2025-01-08',
                record_date: '2025-03-27',
                payment_date: '2025-03-28',
                amount: '0.192276'
            },
            {
                ex_dividend_date: '2025-03-20',
                declaration_date: '2025-01-08',
                record_date: '2025-03-20',
                payment_date: '2025-03-21',
                amount: '0.326605'
            },
            {
                ex_dividend_date: '2025-03-13',
                declaration_date: 'None',
                record_date: 'None',
                payment_date: 'None',
                amount: '0.300946'
            },
            {
                ex_dividend_date: '2025-03-06',
                declaration_date: '2025-01-08',
                record_date: '2025-03-06',
                payment_date: '2025-03-07',
                amount: '0.149736'
            },
            {
                ex_dividend_date: '2025-02-27',
                declaration_date: '2025-01-08',
                record_date: '2025-02-27',
                payment_date: '2025-02-28',
                amount: '0.193473'
            },
            {
                ex_dividend_date: '2025-02-20',
                declaration_date: '2025-01-08',
                record_date: '2025-02-20',
                payment_date: '2025-02-21',
                amount: '0.202667'
            },
            {
                ex_dividend_date: '2025-02-13',
                declaration_date: '2025-01-08',
                record_date: '2025-02-13',
                payment_date: '2025-02-14',
                amount: '0.253721'
            },
            {
                ex_dividend_date: '2025-02-06',
                declaration_date: '2025-01-08',
                record_date: '2025-02-06',
                payment_date: '2025-02-07',
                amount: '0.279654'
            },
            {
                ex_dividend_date: '2025-01-30',
                declaration_date: '2025-01-08',
                record_date: '2025-01-30',
                payment_date: '2025-01-31',
                amount: '0.215479'
            },
            {
                ex_dividend_date: '2025-01-23',
                declaration_date: '2025-01-08',
                record_date: '2025-01-23',
                payment_date: '2025-01-24',
                amount: '0.200155'
            },
            {
                ex_dividend_date: '2025-01-16',
                declaration_date: '2025-01-08',
                record_date: '2025-01-16',
                payment_date: '2025-01-17',
                amount: '0.375482'
            },
            {
                ex_dividend_date: '2025-01-08',
                declaration_date: '2025-01-07',
                record_date: '2025-01-08',
                payment_date: '2025-01-10',
                amount: '0.20576'
            },
            {
                ex_dividend_date: '2025-01-02',
                declaration_date: '2024-12-31',
                record_date: '2025-01-02',
                payment_date: '2025-01-03',
                amount: '0.590683'
            },
            {
                ex_dividend_date: '2024-12-26',
                declaration_date: '2024-12-24',
                record_date: '2024-12-26',
                payment_date: '2024-12-27',
                amount: '0.273542'
            },
            {
                ex_dividend_date: '2024-12-19',
                declaration_date: '2024-12-18',
                record_date: '2024-12-19',
                payment_date: '2024-12-20',
                amount: '0.264902'
            },
            {
                ex_dividend_date: '2024-12-12',
                declaration_date: '2024-12-11',
                record_date: '2024-12-12',
                payment_date: '2024-12-13',
                amount: '0.371052'
            },
            {
                ex_dividend_date: '2024-12-05',
                declaration_date: '2024-12-04',
                record_date: '2024-12-05',
                payment_date: '2024-12-06',
                amount: '0.28264'
            },
            {
                ex_dividend_date: '2024-11-27',
                declaration_date: '2024-11-26',
                record_date: '2024-11-27',
                payment_date: '2024-11-29',
                amount: '0.327406'
            },
            {
                ex_dividend_date: '2024-11-21',
                declaration_date: '2024-11-20',
                record_date: '2024-11-21',
                payment_date: '2024-11-22',
                amount: '0.410503'
            },
            {
                ex_dividend_date: '2024-11-14',
                declaration_date: '2024-11-13',
                record_date: '2024-11-14',
                payment_date: '2024-11-15',
                amount: '0.334341'
            },
            {
                ex_dividend_date: '2024-11-07',
                declaration_date: '2024-11-06',
                record_date: '2024-11-07',
                payment_date: '2024-11-08',
                amount: '0.262856'
            },
            {
                ex_dividend_date: '2024-10-31',
                declaration_date: '2024-10-30',
                record_date: '2024-10-31',
                payment_date: '2024-11-01',
                amount: '0.257541'
            },
            {
                ex_dividend_date: '2024-10-24',
                declaration_date: '2024-10-23',
                record_date: '2024-10-24',
                payment_date: '2024-10-25',
                amount: '0.335223'
            },
            {
                ex_dividend_date: '2024-10-17',
                declaration_date: '2024-09-16',
                record_date: '2024-10-17',
                payment_date: '2024-10-18',
                amount: '0.306793'
            },
            {
                ex_dividend_date: '2024-10-10',
                declaration_date: '2024-09-16',
                record_date: '2024-10-10',
                payment_date: '2024-10-11',
                amount: '0.249786'
            },
            {
                ex_dividend_date: '2024-10-03',
                declaration_date: '2024-09-16',
                record_date: '2024-10-03',
                payment_date: '2024-10-04',
                amount: '0.386265'
            },
            {
                ex_dividend_date: '2024-09-26',
                declaration_date: '2024-09-16',
                record_date: '2024-09-26',
                payment_date: '2024-09-27',
                amount: '0.360323'
            }
        ]
    }

    return json
}

async function fetchData() {
    const m = new Map<string, DividendPrice[]>();

    for (const symbol of symbols) {
        let dividendData: DividendPrice[] = [];

        // Construct Daily Price API URL
        const dailyPriceUrl = `${DailyPriceAPI_Base}&symbol=${symbol}&apikey=${ALPHAVANTAGE_API_KEY}&outputsize=full`;
        console.log(`Fetching daily price for ${symbol} from: ${dailyPriceUrl}`);

        // Construct Dividend API URL
        const dividendUrl = `${DividendAPI_Base}&symbol=${symbol}&apikey=${ALPHAVANTAGE_API_KEY}`;
        console.log(`Fetching dividends for ${symbol} from: ${dividendUrl}`);

        try {
            // Fetch Daily Price Data
            const dailyPriceResponse = await fetch(dailyPriceUrl);
            if (!dailyPriceResponse.ok) {
                throw new Error(`HTTP error! status: ${dailyPriceResponse.status} for ${dailyPriceUrl}`);
            }
            // const dailyPriceResponse = await priceAPI();
            const dailyPriceAPIData: any = await dailyPriceResponse.json();
            // console.log(`Daily Price Data for ${symbol}:`, dailyPriceAPIData);

            // Fetch Dividend Data
            const dividendResponse = await fetch(dividendUrl);
            if (!dividendResponse.ok) {
                throw new Error(`HTTP error! status: ${dividendResponse.status} for ${dividendUrl}`);
            }
            // const dividendResponse = await dividendAPI();
            const dividendAPIData: any = await dividendResponse.json();
            // console.log(`Dividend Data for ${symbol}:`, dividendAPIData);

            // Extract the dividend data
            dividendData = dividendAPIData.data.map((item: any) => ({
                date: item.ex_dividend_date,
                dividend: item.amount,
                price: dailyPriceAPIData['Time Series (Daily)']?.[item.ex_dividend_date]?.['4. close'],
            }));

            // Save the data in the map
            m.set(symbol, dividendData);

        } catch (error) {
            console.error(`Failed to fetch data for ${symbol}:`, error);
        }
        console.log('---'); // Separator for better readability
    }

    return m
}

import * as fs from 'fs';

fetchData().then(data => {
    data.forEach((value, key) => {
        const filename = `${key}.json`;
        const filePath = `public/data/${filename}`;
        const jsonData = JSON.stringify(value, null, 2);

        fs.writeFile(filePath, jsonData, (err) => {
            if (err) {
                console.error(`Failed to write file ${filename}:`, err);
            } else {
                console.log(`Successfully wrote file ${filename}`);
            }
        });
    });
});
